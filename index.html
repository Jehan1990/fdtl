<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jehan‚Äôs FDTL Calculator Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: {
                        brand: {
                            DEFAULT: '#1e3a8a',
                            light: '#0ea5e9',
                        },
                        midnight: '#000000'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=JetBrains+Mono&display=swap');
        body { transition: background-color 0.3s ease, color 0.3s ease; }
        .glass { backdrop-filter: blur(16px); }
        .light .glass { background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(30, 58, 138, 0.1); }
        .dark .glass { background: rgba(25, 25, 25, 0.7); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        #customAlert { display: none; }
        .alert-overlay { position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; padding: 1.5rem; }
        .light .alert-overlay { background: rgba(30, 58, 138, 0.15); }
        .dark .alert-overlay { background: rgba(0, 0, 0, 0.6); }

        .light .alert-card { border-color: rgba(30, 58, 138, 0.3); }
        .dark .alert-card { border-color: rgba(244, 63, 94, 0.4); }

        input[type="time"]::-webkit-calendar-picker-indicator { cursor: pointer; }
        .dark input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        .table-row-grid { display: grid; grid-template-columns: 1fr 1fr 1.5fr; text-align: center; padding: 8px 0; }
        .theme-toggle-wrapper { width: 100%; display: flex; justify-content: flex-end; padding: 1rem 1rem 0 0; position: absolute; top: 0; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-midnight text-slate-900 dark:text-white min-h-screen flex flex-col items-center p-4 relative font-sans">

    <div id="customAlert" class="alert-overlay backdrop-blur-md">
        <div class="glass alert-card w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl border-2 text-center animate-in zoom-in duration-200">
            <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 bg-brand/10 text-brand dark:bg-rose-500/10 dark:text-rose-500">
                <i class="fas fa-clock text-2xl"></i>
            </div>
            <h3 class="text-lg font-black uppercase tracking-tight mb-2 text-brand dark:text-rose-400">Invalid Time</h3>
            <p class="text-[12px] leading-relaxed font-bold opacity-80 uppercase mb-6">
                INVALID TIME AS BOTH TIMES ARE IN WOCL PERIOD
            </p>
            <button onclick="closeAlert()" class="w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all active:scale-95 shadow-lg bg-brand dark:bg-rose-500 text-white shadow-brand/30 dark:shadow-rose-500/30">
                Acknowledge
            </button>
        </div>
    </div>

    <div class="theme-toggle-wrapper">
        <button onclick="toggleTheme()" class="w-12 h-12 rounded-2xl glass flex items-center justify-center shadow-lg hover:scale-105 transition-transform active:scale-95">
            <i id="themeIcon" class="fas fa-moon text-brand dark:text-white"></i>
        </button>
    </div>

    <div class="w-full max-w-md space-y-6 mt-12">
        <header class="text-center space-y-1">
            <h1 class="text-3xl font-black italic tracking-tighter uppercase">
                FDTL <span class="text-brand dark:text-white">CALC</span>
            </h1>
            <p class="text-slate-500 dark:text-gray-400 text-[11px] font-bold uppercase tracking-[0.15em]">Detailed Crew Compliance Tool</p>
        </header>

        <div class="glass rounded-[2.5rem] p-6 md:p-8 shadow-2xl">
            <div class="space-y-5">
                <div class="group">
                    <label class="text-[10px] font-black text-brand dark:text-white uppercase tracking-widest ml-1 mb-2 block">Reporting Time</label>
                    <div class="flex items-center bg-white dark:bg-zinc-900 p-4 rounded-2xl border border-slate-200 dark:border-transparent focus-within:border-brand-light dark:focus-within:border-white transition-all shadow-sm">
                        <i class="fas fa-clock-rotate-left mr-3 text-brand-light dark:text-gray-500"></i>
                        <input type="time" id="reportTime" oninput="calculate()" class="w-full bg-transparent text-2xl font-bold mono outline-none">
                    </div>
                </div>

                <div class="group">
                    <label class="text-[10px] font-black text-brand dark:text-white uppercase tracking-widest ml-1 mb-2 block">Chocks On</label>
                    <div class="flex items-center bg-white dark:bg-zinc-900 p-4 rounded-2xl border border-slate-200 dark:border-transparent focus-within:border-brand-light dark:focus-within:border-white transition-all shadow-sm">
                        <i class="fas fa-plane-arrival mr-3 text-brand-light dark:text-gray-500"></i>
                        <input type="time" id="chocksOn" oninput="calculate()" class="w-full bg-transparent text-2xl font-bold mono outline-none">
                    </div>
                </div>

                <div class="bg-slate-100/50 dark:bg-zinc-900 p-4 rounded-2xl border border-transparent">
                    <label class="text-[10px] font-black text-brand dark:text-white uppercase tracking-widest block mb-3 text-center">Number of Landings</label>
                    <div class="flex items-center justify-between px-4">
                        <button onclick="changeLnd(-1)" class="w-12 h-12 rounded-xl bg-white dark:bg-zinc-800 shadow-sm hover:scale-110 transition-transform active:scale-95 text-brand dark:text-white"><i class="fas fa-minus"></i></button>
                        <span id="landingsCount" class="text-4xl font-black mono text-brand dark:text-white">1</span>
                        <button onclick="changeLnd(1)" class="w-12 h-12 rounded-xl bg-white dark:bg-zinc-800 shadow-sm hover:scale-110 transition-transform active:scale-95 text-brand dark:text-white"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <div id="results" class="hidden space-y-4">
                    <div id="statusBox" class="p-5 rounded-[1.5rem] border flex items-center gap-4 shadow-sm">
                        <div id="statusIcon" class="text-3xl"></div>
                        <div class="flex-1">
                            <p class="text-[9px] font-bold uppercase opacity-60">Compliance Verdict</p>
                            <h2 id="statusTitle" class="text-xl font-black tracking-tight uppercase">--</h2>
                        </div>
                        <button onclick="shareReport()" class="w-12 h-12 rounded-2xl bg-white/20 dark:bg-white/10 flex flex-col items-center justify-center hover:scale-105 active:scale-90 transition-all border border-white/10">
                            <i class="fas fa-share-nodes text-xs"></i>
                            <span class="text-[8px] font-bold uppercase mt-1">Share</span>
                        </button>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 rounded-2xl bg-white/50 dark:bg-zinc-900/50 border border-slate-200 dark:border-zinc-800 text-center">
                            <p class="text-[9px] font-bold text-slate-500 dark:text-gray-500 uppercase">Actual FDP</p>
                            <p id="resActual" class="text-xl font-bold mono">--:--</p>
                        </div>
                        <div class="p-4 rounded-2xl bg-white/50 dark:bg-zinc-900/50 border border-slate-200 dark:border-zinc-800 text-center">
                            <p class="text-[9px] font-bold text-slate-500 dark:text-gray-500 uppercase">Max Allowed</p>
                            <p id="resMax" class="text-xl font-bold mono text-brand dark:text-white">--:--</p>
                        </div>
                    </div>

                    <div class="p-4 rounded-2xl bg-brand/5 dark:bg-white/5 border border-brand/10 dark:border-white/10 text-[11px] space-y-2">
                        <div class="flex justify-between">
                            <span class="text-slate-500 dark:text-gray-400">Base FDP Limit:</span>
                            <span id="resBase" class="font-bold">--:--</span>
                        </div>
                        <div class="flex justify-between border-t border-brand/5 dark:border-white/5 pt-2">
                            <span class="text-slate-500 dark:text-gray-400">WOCL Penalty:</span>
                            <span id="resPenalty" class="font-bold">--:--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass rounded-[1.5rem] p-5 shadow-lg border-white/10">
            <h3 class="text-[10px] font-black text-brand dark:text-white uppercase tracking-widest mb-4 text-center">DGCA Reference Table</h3>
            <div class="text-[11px]">
                <div class="table-row-grid font-bold text-slate-400 dark:text-gray-500 border-b border-slate-200 dark:border-zinc-800 pb-2 mb-2">
                    <span>LDG</span>
                    <span>MAX FT</span>
                    <span>MAX FDP</span>
                </div>
                <div class="space-y-1">
                    <div class="table-row-grid"><span>1</span><span>10 hrs</span><span class="font-bold">13:00</span></div>
                    <div class="table-row-grid bg-brand-light/5 dark:bg-zinc-900/40 rounded-lg"><span>2</span><span>9 hrs</span><span class="font-bold">13:00</span></div>
                    <div class="table-row-grid"><span>3</span><span>8 hrs</span><span class="font-bold">12:30</span></div>
                    <div class="table-row-grid bg-brand-light/5 dark:bg-zinc-900/40 rounded-lg"><span>4</span><span>8 hrs</span><span class="font-bold">12:00</span></div>
                    <div class="table-row-grid"><span>5</span><span>8 hrs</span><span class="font-bold">11:30</span></div>
                    <div class="table-row-grid bg-brand-light/5 dark:bg-zinc-900/40 rounded-lg"><span>6</span><span>8 hrs</span><span class="font-bold">11:00</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let lnd = 1;
        let lastResult = {};

        // Theme Storage Logic
        if (localStorage.theme === 'light') {
            document.documentElement.classList.remove('dark');
            document.getElementById('themeIcon').className = 'fas fa-sun text-brand';
        }

        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('themeIcon');
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                icon.className = 'fas fa-sun text-brand';
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                icon.className = 'fas fa-moon text-white';
            }
        }

        function closeAlert() {
            document.getElementById('customAlert').style.display = 'none';
        }

        function triggerWoclError() {
            document.getElementById('customAlert').style.display = 'flex';
        }

        function changeLnd(val) {
            lnd = Math.max(1, Math.min(6, lnd + val));
            document.getElementById('landingsCount').innerText = lnd;
            calculate();
        }

        function tToD(t) {
            const [h, m] = t.split(':').map(Number);
            return h + (m / 60);
        }

        function dToT(d) {
            const h = Math.floor(d);
            const m = Math.round((d - h) * 60);
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
        }

        function calculate() {
            const rInput = document.getElementById('reportTime');
            const cInput = document.getElementById('chocksOn');
            const resultsDiv = document.getElementById('results');
            const penaltySpan = document.getElementById('resPenalty');

            if (!rInput.value || !cInput.value) return;

            try {
                const start = tToD(rInput.value);
                const endRaw = tToD(cInput.value);
                let end = endRaw;
                if (end < start) end += 24;

                // Validation: Check if both are between 02:00 and 06:00
                const isStartInWocl = (start >= 2 && start <= 6);
                const isEndInWocl = (endRaw >= 2 && endRaw <= 6);

                if (isStartInWocl && isEndInWocl) {
                    throw new Error("WOCL_PERIOD_VIOLATION");
                }

                resultsDiv.classList.remove('hidden');

                const actualFDP = end - start;
                const baseLimits = { 1: 13.0, 2: 13.0, 3: 12.5, 4: 12.0, 5: 11.5, 6: 11.0 };
                const baseFDP = baseLimits[lnd];

                const wStart = 2, wEnd = 6;
                const oStart = Math.max(start, wStart);
                const oEnd = Math.min(end, wEnd);
                let overlap = Math.max(0, oEnd - oStart);
                overlap += Math.max(0, Math.min(end, 30) - Math.max(start, 26));

                let penalty = 0;
                if (start >= 2 && start < 6) {
                    penalty = Math.min(overlap, 2); 
                } else if (overlap > 0) {
                    penalty = overlap * 0.5; 
                }

                // Penalty Color Red when > 0
                penaltySpan.className = (penalty > 0) ? "font-bold text-red-600 dark:text-red-500" : "font-bold text-slate-900 dark:text-white";

                const allowed = baseFDP - penalty;
                const isLegal = actualFDP <= (allowed + 0.001);

                document.getElementById('resActual').innerText = dToT(actualFDP);
                document.getElementById('resMax').innerText = dToT(allowed);
                document.getElementById('resBase').innerText = dToT(baseFDP);
                penaltySpan.innerText = `-${dToT(penalty)}`;

                lastResult = {
                    report: rInput.value, chocks: cInput.value, landings: lnd,
                    actual: dToT(actualFDP), max: dToT(allowed),
                    base: dToT(baseFDP), penalty: dToT(penalty),
                    status: isLegal ? "‚úÖ LEGAL" : "‚ùå ILLEGAL"
                };

                const box = document.getElementById('statusBox');
                const title = document.getElementById('statusTitle');
                const icon = document.getElementById('statusIcon');

                if(isLegal) {
                    box.className = "p-5 rounded-[1.5rem] bg-emerald-500/10 border-emerald-500/40 flex items-center gap-4 text-emerald-600 dark:text-emerald-400 shadow-sm transition-all";
                    title.innerText = "Legal";
                    icon.innerHTML = '<i class="fas fa-check-circle"></i>';
                } else {
                    box.className = "p-5 rounded-[1.5rem] bg-rose-500/10 border-rose-500/40 border-dashed flex items-center gap-4 text-rose-600 dark:text-rose-400 shadow-sm transition-all";
                    title.innerText = "Illegal";
                    icon.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                }

            } catch (err) {
                if (err.message === "WOCL_PERIOD_VIOLATION") {
                    triggerWoclError();
                    rInput.value = "";
                    cInput.value = "";
                    resultsDiv.classList.add('hidden');
                }
            }
        }

        async function shareReport() {
            if (!lastResult.report) return;
            const text = `‚úàÔ∏è *FDTL COMPLIANCE REPORT*\n----------------------------\nüìÖ *Duty Details:*\n‚Ä¢ Reporting: ${lastResult.report}\n‚Ä¢ Chocks On: ${lastResult.chocks}\n‚Ä¢ Landings: ${lastResult.landings}\n\n‚è±Ô∏è *FDP Analysis:*\n‚Ä¢ Actual FDP: ${lastResult.actual}\n‚Ä¢ Base Limit: ${lastResult.base}\n‚Ä¢ WOCL Penalty: -${lastResult.penalty}\n‚Ä¢ **Max Allowed: ${lastResult.max}**\n\nüì¢ *Verdict: ${lastResult.status}*\n----------------------------\n_Generated via FDTL Pro_`;
            if (navigator.share) {
                try { await navigator.share({ title: 'FDTL Detailed Report', text: text }); } 
                catch (err) { }
            } else {
                navigator.clipboard.writeText(text);
                alert("Report copied to clipboard!");
            }
        }
    </script>
</body>
</html>
