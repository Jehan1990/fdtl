<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jehan’s FDTL Calculator Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        (function() {
            const hour = new Date().getHours();
            const isDay = hour >= 6 && hour < 18;
            if (isDay) {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();

        tailwind.config = { 
            darkMode: 'class', 
            theme: { 
                extend: { 
                    fontFamily: { sans: ['Outfit', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }, 
                    colors: { 
                        md: {
                            primary: '#005fb0',
                            onPrimary: '#ffffff',
                            primaryContainer: '#d4e3ff',
                            onPrimaryContainer: '#001c3b',
                            surface: '#fdfbff',
                            onSurface: '#1a1c1e',
                            surfaceVariant: '#e0e2ec',
                            onSurfaceVariant: '#44474e',
                            outline: '#74777f',
                            darkSurface: '#1a1c1e',
                            darkOnSurface: '#e2e2e6',
                            darkPrimary: '#a5c8ff',
                            darkPrimaryContainer: '#004786'
                        }
                    } 
                } 
            } 
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700&family=JetBrains+Mono:wght@400;700;800&display=swap');
        
        body { 
            transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            -webkit-user-select: none; 
            user-select: none; 
            touch-action: manipulation;
        }

        .particles { position: fixed; inset: 0; pointer-events: none; z-index: 50; }
        .particle { position: absolute; background: currentColor; border-radius: 50%; opacity: 0.15; animation: float 12s infinite linear; }
        @keyframes float {
            0% { transform: translateY(105vh) scale(0); opacity: 0; }
            50% { opacity: 0.2; }
            100% { transform: translateY(-10vh) scale(1.5); opacity: 0; }
        }

        .m3-card {
            border-radius: 28px;
            transition: all 0.3s ease;
        }
        .light .m3-card, :not(.dark) .m3-card { background: #f3f4f9; border: 1px solid rgba(0,0,0,0.05); }
        .dark .m3-card { background: #222529; border: 1px solid rgba(255,255,255,0.05); }

        .format-container { 
            background: #e0e2ec; 
            border-radius: 100px; 
            padding: 4px; 
            display: flex; 
            position: relative; 
            width: fit-content;
            margin: 0 auto;
        }
        .dark .format-container { background: #44474e; }
        .format-btn { 
            padding: 8px 20px; 
            font-size: 12px; 
            font-weight: 500; 
            color: #44474e; 
            position: relative; 
            z-index: 2; 
        }
        .dark .format-btn { color: #c4c6d0; }
        .format-btn.active { color: #ffffff; }
        .dark .format-btn.active { color: #00315e; }
        
        .toggle-slider { 
            position: absolute; 
            height: calc(100% - 8px); 
            width: calc(50% - 4px); 
            background: #005fb0; 
            border-radius: 100px; 
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 1; 
        }
        .dark .toggle-slider { background: #a5c8ff; }
        .toggle-dec { transform: translateX(100%); }

        .modal-overlay { 
            position: fixed; 
            inset: 0; 
            z-index: 100; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(10px);
        }
        .modal-overlay.active { display: flex; }
        
        .bw-picker-card { 
            background: #ffffff; 
            color: #1a1c1e; 
            border-radius: 28px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 1px solid rgba(0,0,0,0.1);
        }
        .dark .bw-picker-card { 
            background: #1e1f21; 
            color: #e2e2e6; 
            border: 1px solid rgba(255,255,255,0.1);
        }

        .time-wheels { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 200px; 
            overflow: hidden; 
            mask-image: linear-gradient(to bottom, transparent 0%, black 45%, black 55%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 45%, black 55%, transparent 100%);
            position: relative;
            touch-action: pan-y;
            perspective: 1000px;
        }
        .wheel { 
            flex: 1; 
            height: 100%; 
            overflow-y: scroll; 
            overflow-x: hidden;
            scroll-snap-type: y mandatory; 
            scrollbar-width: none; 
            overscroll-behavior: contain;
            scroll-behavior: auto; 
            -webkit-overflow-scrolling: touch;
        }
        .wheel::-webkit-scrollbar { display: none; }
        
        .wheel div { 
            height: 50px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.5rem; 
            scroll-snap-align: center; 
            opacity: 0.35; 
            transform: scale(0.85);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: 'JetBrains Mono', monospace;
            color: #44474e;
            font-weight: 500;
            width: 100%;
        }
        .dark .wheel div { color: #c4c6d0; }

        /* Enhanced Glow and Elevation Effect */
        .wheel div.in-focus {
            opacity: 1 !important;
            transform: scale(1.3) translateZ(20px) !important;
            font-weight: 800;
            color: #005fb0;
            filter: drop-shadow(0 0 8px rgba(0, 95, 176, 0.5));
        }
        .dark .wheel div.in-focus { 
            color: #a5c8ff;
            filter: drop-shadow(0 0 12px rgba(165, 200, 255, 0.6));
        }

        .selection-highlight { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            width: 85%; 
            height: 50px; 
            background: rgba(128, 128, 128, 0.04); 
            border: 1px solid rgba(0, 95, 176, 0.1);
            border-radius: 12px;
            z-index: 0; 
            pointer-events: none;
        }

        .table-row-grid { display: grid; grid-template-columns: 1fr 1fr 1.5fr; text-align: center; padding: 14px 8px; }
    </style>
</head>
<body class="bg-md-surface dark:bg-md-darkSurface text-md-onSurface dark:text-md-darkOnSurface min-h-screen flex flex-col items-center p-4 md:p-8 font-sans" oncontextmenu="return false;">

    <div class="particles" id="pickerParticles"></div>

    <div class="modal-overlay" id="errorModal">
        <div class="bw-picker-card w-full max-w-[300px] p-6 border-t-4 border-red-500">
            <div class="flex items-center gap-3 mb-4 text-red-600 dark:text-red-400">
                <i class="fas fa-circle-exclamation text-xl"></i>
                <h4 class="text-sm font-bold uppercase tracking-wider">Invalid Times</h4>
            </div>
            <p class="text-sm opacity-80 leading-relaxed mb-6">
                Both <span class="font-bold">Reporting</span> and <span class="font-bold">Chocks On</span> times are within the WOCL period (02:00 - 06:00). Resetting inputs.
            </p>
            <button onclick="closeError()" class="w-full py-3 bg-md-primary dark:bg-md-darkPrimary text-md-onPrimary dark:text-md-onPrimaryContainer rounded-2xl font-bold">OKAY</button>
        </div>
    </div>

    <div class="modal-overlay" id="timePickerModal">
        <div class="bw-picker-card w-[320px] p-6 relative z-[110]">
            <h4 id="pickerTitle" class="text-[11px] font-bold tracking-[0.2em] mb-6 text-md-primary dark:text-md-darkPrimary text-center uppercase opacity-70">Set Time</h4>
            <div class="time-wheels mb-6">
                <div class="selection-highlight"></div>
                <div class="wheel" id="hoursWheel"></div>
                <div class="text-2xl font-black px-2 z-10 text-md-primary dark:text-md-darkPrimary opacity-40">:</div>
                <div class="wheel" id="minsWheel"></div>
            </div>
            <div class="flex gap-3">
                <button onclick="closePicker()" class="flex-1 py-4 text-md-onSurface dark:text-md-darkOnSurface opacity-60 font-bold text-[11px] tracking-widest">CANCEL</button>
                <button onclick="confirmTime()" class="flex-1 py-4 bg-md-primary dark:bg-md-darkPrimary text-md-onPrimary dark:text-md-onPrimaryContainer rounded-2xl font-bold text-[11px] tracking-widest shadow-lg">CONFIRM</button>
            </div>
        </div>
    </div>

    <div class="w-full max-w-6xl flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold tracking-tight text-md-primary dark:text-md-darkPrimary">FDTL <span class="italic">PRO</span></h1>
            <p class="text-[11px] font-medium uppercase tracking-[0.1em] opacity-60">Jehan’s Professional Calculator</p>
        </div>
        <button onclick="toggleTheme()" class="w-12 h-12 rounded-full flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5 transition-colors">
            <i id="themeIcon" class="fas fa-circle-half-stroke text-xl"></i>
        </button>
    </div>

    <main class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
        <div class="space-y-6">
            <div class="m3-card p-6 md:p-8 shadow-sm">
                <div class="space-y-6">
                    <div onclick="openPicker('reportTime')" class="relative group cursor-pointer border-b border-md-outline/30 pb-3">
                        <label class="text-sm font-semibold text-md-primary dark:text-md-darkPrimary block mb-1">Reporting Time</label>
                        <div class="flex items-center">
                            <i class="fas fa-clock mr-3 opacity-50"></i>
                            <input type="text" id="reportTime" readonly placeholder="--:--" class="bg-transparent text-3xl font-medium outline-none pointer-events-none">
                        </div>
                    </div>

                    <div onclick="openPicker('chocksOn')" class="relative group cursor-pointer border-b border-md-outline/30 pb-3">
                        <label class="text-sm font-semibold text-md-primary dark:text-md-darkPrimary block mb-1">Chocks On</label>
                        <div class="flex items-center">
                            <i class="fas fa-plane-arrival mr-3 opacity-50"></i>
                            <input type="text" id="chocksOn" readonly placeholder="--:--" class="bg-transparent text-3xl font-medium outline-none pointer-events-none">
                        </div>
                    </div>

                    <div class="bg-md-surfaceVariant/30 dark:bg-white/5 p-5 rounded-3xl">
                        <label class="text-[12px] font-bold uppercase tracking-widest block mb-4 text-center opacity-70">Number of Landings</label>
                        <div class="flex items-center justify-between px-6">
                            <button onclick="changeLnd(-1)" class="w-12 h-12 rounded-2xl bg-md-primaryContainer dark:bg-md-darkPrimaryContainer text-md-onPrimaryContainer dark:text-white flex items-center justify-center text-lg"><i class="fas fa-minus"></i></button>
                            <span id="landingsCount" class="text-5xl font-bold mono">1</span>
                            <button onclick="changeLnd(1)" class="w-12 h-12 rounded-2xl bg-md-primaryContainer dark:bg-md-darkPrimaryContainer text-md-onPrimaryContainer dark:text-white flex items-center justify-center text-lg"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>

                    <div id="results" class="hidden space-y-6 pt-6 border-t border-md-outline/10">
                        <div class="format-container">
                            <div id="toggleSlider" class="toggle-slider"></div>
                            <button id="fmtHHMM" onclick="setFormat('HH:MM')" class="format-btn active">HH:MM</button>
                            <button id="fmtDEC" onclick="setFormat('DEC')" class="format-btn">DECIMAL</button>
                        </div>

                        <div id="statusBox" class="p-5 rounded-3xl flex items-center gap-4 transition-all">
                            <div id="statusIcon" class="text-3xl"></div>
                            <div class="flex-1">
                                <h2 id="statusTitle" class="text-xl font-bold uppercase tracking-tight">--</h2>
                            </div>
                            <button onclick="shareReport()" class="w-12 h-12 rounded-full bg-black/5 dark:bg-white/5 flex items-center justify-center">
                                <i class="fas fa-share-nodes text-lg"></i>
                            </button>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-5 rounded-3xl bg-white dark:bg-white/5 border border-md-outline/10 text-center">
                                <p class="text-[11px] font-bold opacity-60 uppercase mb-1">Actual FDP</p>
                                <p id="resActual" class="text-2xl font-bold mono">--:--</p>
                            </div>
                            <div class="p-5 rounded-3xl bg-white dark:bg-white/5 border border-md-outline/10 text-center">
                                <p class="text-[11px] font-bold opacity-60 uppercase mb-1">Max Allowed</p>
                                <p id="resMax" class="text-2xl font-bold mono text-md-primary dark:text-md-darkPrimary">--:--</p>
                            </div>
                        </div>

                        <div class="p-5 rounded-3xl bg-md-primary/5 dark:bg-md-darkPrimary/5 space-y-3">
                            <div class="flex justify-between">
                                <span class="opacity-70 font-medium">Base FDP Limit:</span>
                                <span id="resBase" class="font-bold text-lg mono">--:--</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="opacity-70 font-medium">WOCL Penalty:</span>
                                <span id="resPenalty" class="font-bold text-lg mono">--:--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="m3-card p-6 md:p-8">
            <h3 class="text-[13px] font-bold opacity-60 uppercase tracking-[0.2em] mb-6 text-center">DGCA Reference Table</h3>
            <div class="space-y-1">
                <div class="table-row-grid font-bold opacity-40 border-b border-md-outline/10 mb-2 text-sm">
                    <span>LDG</span><span>MAX FT</span><span>MAX FDP</span>
                </div>
                <div class="table-row-grid text-base md:text-lg"><span>1</span><span>10:00</span><span class="font-bold text-md-primary dark:text-md-darkPrimary">13:00</span></div>
                <div class="table-row-grid bg-md-primary/5 rounded-xl text-base md:text-lg"><span>2</span><span>09:00</span><span class="font-bold text-md-primary dark:text-md-darkPrimary">13:00</span></div>
                <div class="table-row-grid text-base md:text-lg"><span>3</span><span>08:00</span><span class="font-bold text-md-primary dark:text-md-darkPrimary">12:30</span></div>
                <div class="table-row-grid bg-md-primary/5 rounded-xl text-base md:text-lg"><span>4</span><span>08:00</span><span class="font-bold text-md-primary dark:text-md-darkPrimary">12:00</span></div>
                <div class="table-row-grid text-base md:text-lg"><span>5</span><span>08:00</span><span class="font-bold text-md-primary dark:text-md-darkPrimary">11:30</span></div>
                <div class="table-row-grid bg-md-primary/5 rounded-xl text-base md:text-lg"><span>6</span><span>08:00</span><span class="font-bold text-md-primary dark:text-md-darkPrimary">11:00</span></div>
            </div>
        </div>
    </main>

    <script>
        let lnd=1; let lastResult={}; let displayFormat='HH:MM'; let activeInputId='';
        const hWheel=document.getElementById('hoursWheel'); const mWheel=document.getElementById('minsWheel');
        const particleContainer = document.getElementById('pickerParticles');

        function updateFocus() {
            const wheels = [hWheel, mWheel];
            wheels.forEach(wheel => {
                const center = wheel.scrollTop + (wheel.clientHeight / 2);
                const digits = wheel.querySelectorAll('.digit');
                digits.forEach(digit => {
                    const digitCenter = digit.offsetTop + (digit.clientHeight / 2);
                    const distance = Math.abs(center - digitCenter);
                    // Higher sensitivity (distance < 25) for smooth transition
                    if (distance < 25) {
                        digit.classList.add('in-focus');
                    } else {
                        digit.classList.remove('in-focus');
                    }
                });
            });
            if(document.getElementById('timePickerModal').classList.contains('active')) {
                requestAnimationFrame(updateFocus);
            }
        }

        function createParticles() {
            particleContainer.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                const p = document.createElement('div');
                p.className = 'particle text-md-primary dark:text-md-darkPrimary';
                p.style.left = Math.random() * 100 + 'vw';
                p.style.width = p.style.height = Math.random() * 3 + 2 + 'px';
                p.style.animationDelay = Math.random() * 5 + 's';
                particleContainer.appendChild(p);
            }
        }

        function initWheel(c, count) {
            c.innerHTML = '<div style="height:75px"></div>'; 
            for (let i=0; i<count; i++) {
                const d=document.createElement('div'); 
                d.className = 'digit';
                d.textContent=i.toString().padStart(2,'0');
                c.appendChild(d);
            }
            c.innerHTML += '<div style="height:75px"></div>';
        }
        initWheel(hWheel, 24); initWheel(mWheel, 60);

        function openPicker(id) {
            activeInputId = id;
            const modal = document.getElementById('timePickerModal');
            modal.classList.add('active');
            createParticles();
            
            const val = document.getElementById(id).value || "12:00";
            const [h, m] = val.split(':').map(Number);
            
            setTimeout(() => {
                hWheel.scrollTop = h * 50;
                mWheel.scrollTop = m * 50;
                requestAnimationFrame(updateFocus);
            }, 10);
        }

        function closePicker() {
            document.getElementById('timePickerModal').classList.remove('active');
            particleContainer.innerHTML = '';
        }

        function confirmTime() {
            const h = Math.round(hWheel.scrollTop/50);
            const m = Math.round(mWheel.scrollTop/50);
            document.getElementById(activeInputId).value = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
            closePicker();
            calculate();
        }

        function closeError() { document.getElementById('errorModal').classList.remove('active'); }

        function calculate(){
            const r=document.getElementById('reportTime'), c=document.getElementById('chocksOn'), res=document.getElementById('results');
            if(!r.value || !c.value) return;
            
            const s = tToD(r.value); let rawE = tToD(c.value); let e = rawE; 
            if(e < s) e += 24;

            const inWoclRange = (t) => (t >= 2.0 && t <= 6.0);
            if(inWoclRange(s) && inWoclRange(rawE)){
                document.getElementById('errorModal').classList.add('active');
                r.value=''; c.value=''; lnd = 1; 
                document.getElementById('landingsCount').innerText = lnd;
                res.classList.add('hidden'); return;
            }

            res.classList.remove('hidden');
            const aF = (e - s);
            const bL = {1:13, 2:13, 3:12.5, 4:12, 5:11.5, 6:11}; 
            const bF = bL[lnd];
            
            let p = 0;
            if (s >= 2.0 && s <= 6.0) { 
                p = Math.min(Math.min(e, 6.0) - s, 2.0); 
            } else {
                let overlap = Math.max(0, Math.min(e, 6.0) - Math.max(s, 2.0)) + Math.max(0, Math.min(e, 30.0) - Math.max(s, 26.0));
                
                if (overlap > 0) {
                    let totalMins = Math.round(overlap * 60);
                    let halfMins = totalMins / 2;
                    let finalMins = Math.floor(halfMins);
                    p = finalMins / 60;
                }
            }

            const al = bF - p;
            const iL = aF <= (al + 0.0001);
            
            document.getElementById('resActual').innerText = formatValue(aF);
            document.getElementById('resMax').innerText = formatValue(al);
            document.getElementById('resBase').innerText = formatValue(bF);
            
            const pEl = document.getElementById('resPenalty');
            pEl.innerText = p > 0 ? `-${formatValue(p)}` : formatValue(p);
            pEl.className = p > 0 ? "font-bold text-lg mono text-red-500" : "font-bold text-lg mono";
            
            const box = document.getElementById('statusBox'), tit = document.getElementById('statusTitle'), ic = document.getElementById('statusIcon');
            if(iL){
                box.className = "p-5 rounded-3xl bg-green-500/10 border border-green-500/20 flex items-center gap-4 text-green-600 dark:text-green-400";
                tit.innerText = "Legal"; ic.innerHTML = '<i class="fas fa-check-circle"></i>';
            } else {
                box.className = "p-5 rounded-3xl bg-red-500/10 border border-red-500/20 flex items-center gap-4 text-red-600 dark:text-red-400";
                tit.innerText = "Illegal"; ic.innerHTML = '<i class="fas fa-triangle-exclamation"></i>';
            }
            lastResult={report:r.value, chocks:c.value, actual:formatValue(aF), max:formatValue(al), status: iL?"✅ LEGAL":"❌ ILLEGAL"};
        }

        function toggleTheme(){ document.documentElement.classList.toggle('dark'); }
        function changeLnd(v){ lnd=Math.max(1,Math.min(6,lnd+v)); document.getElementById('landingsCount').innerText=lnd; calculate(); }
        function tToD(t){ const[h,m]=t.split(':').map(Number); return h+(m/60); }
        
        function formatValue(d) {
            if(displayFormat==='DEC') return d.toFixed(2);
            const totalMins = Math.round(d * 60);
            const hh = Math.floor(totalMins / 60);
            const mm = totalMins % 60;
            return `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
        }

        function setFormat(fmt) {
            displayFormat = fmt;
            document.getElementById('fmtHHMM').classList.toggle('active', fmt==='HH:MM');
            document.getElementById('fmtDEC').classList.toggle('active', fmt==='DEC');
            document.getElementById('toggleSlider').classList.toggle('toggle-dec', fmt==='DEC');
            calculate();
        }

        async function shareReport(){
            const t=`✈️ FDTL REPORT\nReport: ${lastResult.report}\nChocks: ${lastResult.chocks}\nActual: ${lastResult.actual}\nMax Allowed: ${lastResult.max}\nVerdict: ${lastResult.status}`;
            if(navigator.share) await navigator.share({title:'FDTL Report',text:t});
            else { navigator.clipboard.writeText(t); alert("Report Copied!"); }
        }
    </script>
</body>
</html>
